<div class="flex flex-col h-full bg-white dark:bg-gray-800">
    <!-- Header with Stats and Pagination -->
    <div
        *ngIf="tabsData.size > 0"
        class="flex-shrink-0 px-3 py-2 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800"
    >
        <div class="flex items-center justify-between">
            <!-- Results Info -->
            <div class="flex items-center space-x-3">
                <div
                    class="flex items-center px-2 py-1 bg-white dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 shadow-sm"
                >
                    <span class="icon-[mdi--table-large] w-3 h-3 text-blue-600 dark:text-blue-400 mr-1"></span>
                    <span class="text-xs font-medium text-gray-700 dark:text-gray-300"> {{ totalRows }} rows </span>
                </div>
                <div
                    *ngIf="totalPages > 1"
                    class="text-xs text-gray-600 dark:text-gray-400"
                >
                    Page {{ currentPage }} of {{ totalPages }}
                </div>
            </div>

            <!-- Pagination Controls -->
            <div
                *ngIf="totalPages > 1"
                class="flex items-center space-x-1"
            >
                <button
                    (click)="changePage(1)"
                    [disabled]="currentPage === 1"
                    class="p-1 rounded border border-gray-300 dark:border-gray-600 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
                    title="First page"
                >
                    <span class="icon-[mdi--page-first] w-3 h-3"></span>
                </button>
                <button
                    (click)="changePage(currentPage - 1)"
                    [disabled]="currentPage === 1"
                    class="p-1 rounded border border-gray-300 dark:border-gray-600 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
                    title="Previous page"
                >
                    <span class="icon-[mdi--chevron-left] w-3 h-3"></span>
                </button>

                <!-- Page Input -->
                <div class="flex items-center space-x-1">
                    <input
                        type="number"
                        [value]="currentPage"
                        (keydown.enter)="goToPage($event)"
                        (blur)="goToPage($event)"
                        min="1"
                        [max]="totalPages"
                        class="w-12 px-1 py-0.5 text-xs text-center border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                    />
                    <span class="text-xs text-gray-500 dark:text-gray-400">of {{ totalPages }}</span>
                </div>

                <button
                    (click)="changePage(currentPage + 1)"
                    [disabled]="currentPage === totalPages"
                    class="p-1 rounded border border-gray-300 dark:border-gray-600 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
                    title="Next page"
                >
                    <span class="icon-[mdi--chevron-right] w-3 h-3"></span>
                </button>
                <button
                    (click)="changePage(totalPages)"
                    [disabled]="currentPage === totalPages"
                    class="p-1 rounded border border-gray-300 dark:border-gray-600 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
                    title="Last page"
                >
                    <span class="icon-[mdi--page-last] w-3 h-3"></span>
                </button>
            </div>
        </div>
    </div>

    <!-- Content Area -->
    <div class="flex-1 overflow-hidden">
        <!-- Loading State -->
        <div
            *ngIf="isLoading"
            class="flex items-center justify-center h-full"
        >
            <div class="flex flex-col items-center space-y-3">
                <div class="relative">
                    <div class="w-8 h-8 border-4 border-blue-200 rounded-full animate-spin"></div>
                    <div
                        class="w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin absolute top-0"
                    ></div>
                </div>
                <p class="text-sm text-gray-600 dark:text-gray-400 font-medium">Executing query...</p>
            </div>
        </div>

        <!-- Error State -->
        <div
            *ngIf="errorMessage && !isLoading"
            class="flex items-center justify-center h-full p-6"
        >
            <div class="text-center max-w-md">
                <div
                    class="w-16 h-16 mx-auto mb-4 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center"
                >
                    <span class="icon-[mdi--alert-circle] w-8 h-8 text-red-600 dark:text-red-400"></span>
                </div>
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">Query Error</h3>
                <p
                    class="text-sm text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/10 p-3 rounded-lg border border-red-200 dark:border-red-800"
                >
                    {{ errorMessage }}
                </p>
            </div>
        </div>

        <!-- Empty State -->
        <div
            *ngIf="!isLoading && !errorMessage && rows.length === 0 && tabsData.size > 0"
            class="flex items-center justify-center h-full"
        >
            <div class="text-center">
                <div
                    class="w-16 h-16 mx-auto mb-4 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center"
                >
                    <span class="icon-[mdi--table-off] w-8 h-8 text-gray-400"></span>
                </div>
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">No Results</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400">
                    The query was executed successfully, but returned no rows.
                </p>
            </div>
        </div>

        <!-- Data Table with Modern Scrollbar -->
        <div
            *ngIf="!isLoading && !errorMessage && rows.length > 0"
            class="h-full overflow-auto scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-transparent hover:scrollbar-thumb-gray-600 dark:scrollbar-thumb-gray-600 dark:hover:scrollbar-thumb-gray-500"
        >
            <div class="min-w-full">
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <!-- Table Header -->
                    <thead class="bg-gray-50 dark:bg-gray-700 sticky top-0 z-10">
                        <tr>
                            <th
                                *ngFor="let header of headers; trackBy: trackByHeader"
                                scope="col"
                                class="px-2 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider border-r border-gray-200 dark:border-gray-600 last:border-r-0"
                            >
                                <div class="flex items-center space-x-1">
                                    <span class="icon-[mdi--table-column] w-3 h-3"></span>
                                    <span class="truncate">{{ header }}</span>
                                </div>
                            </th>
                        </tr>
                    </thead>

                    <!-- Table Body -->
                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                        <tr
                            *ngFor="let row of rows; let rowIndex = index; trackBy: trackByRow"
                            class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-150"
                        >
                            <td
                                *ngFor="let header of headers; let colIndex = index; trackBy: trackByHeader"
                                class="px-2 py-1.5 text-sm border-r border-gray-200 dark:border-gray-600 last:border-r-0 relative group"
                                [ngClass]="{
                                    'text-gray-500 dark:text-gray-400 italic': getCellType(row[header]) === 'null',
                                    'text-blue-600 dark:text-blue-400 font-mono': getCellType(row[header]) === 'number',
                                    'text-green-600 dark:text-green-400': getCellType(row[header]) === 'boolean',
                                    'text-purple-600 dark:text-purple-400': getCellType(row[header]) === 'date',
                                    'text-gray-900 dark:text-gray-300': getCellType(row[header]) === 'string',
                                }"
                            >
                                <div
                                    class="flex items-center justify-between cursor-pointer"
                                    (click)="copyToClipboard(row[header], rowIndex, header, $event)"
                                    [title]="'Click to copy: ' + getCellDisplayValue(row[header])"
                                >
                                    <span class="truncate max-w-xs">
                                        {{ getCellDisplayValue(row[header]) | truncate: 50 }}
                                    </span>
                                    <button
                                        class="opacity-0 group-hover:opacity-100 ml-1 p-0.5 rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition-all duration-200"
                                    >
                                        <span class="icon-[mdi--content-copy] w-3 h-3 text-gray-400"></span>
                                    </button>
                                </div>

                                <!-- Copy Tooltip -->
                                <div
                                    *ngIf="copiedCell === rowIndex + '-' + header"
                                    class="absolute z-50 px-2 py-1 text-xs font-medium text-white bg-gray-900 rounded shadow-lg pointer-events-none"
                                    [style.left]="copiedPosition.left + 'px'"
                                    [style.top]="copiedPosition.top + 'px'"
                                >
                                    Copied!
                                    <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full">
                                        <div class="border-4 border-transparent border-t-gray-900"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Initial State -->
        <div
            *ngIf="tabsData.size === 0"
            class="flex items-center justify-center h-full"
        >
            <div class="text-center">
                <div
                    class="w-16 h-16 mx-auto mb-4 bg-blue-100 dark:bg-blue-900/20 rounded-full flex items-center justify-center"
                >
                    <span class="icon-[mdi--database-search] w-8 h-8 text-blue-600 dark:text-blue-400"></span>
                </div>
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">Ready to Execute</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400">
                    Write your SQL query and click Execute to see results here.
                </p>
            </div>
        </div>
    </div>
</div>
