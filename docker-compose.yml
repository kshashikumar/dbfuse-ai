version: "3.8"

services:
  dbfuse-ai:
    container_name: dbfuse-ai
    image: shashikumarkasturi/dbfuse-ai:latest
    restart: unless-stopped
    ports:
      - "5000:5000"
    environment:
      # Web server
      - PORT=5000
      # Optional basic auth for UI (set both to enable)
      - DBFUSE_USERNAME=admin
      - DBFUSE_PASSWORD=admin
      # AI configuration (optional)
      - AI_PROVIDER=gemini
      - AI_MODEL=gemini-2.5-flash
      # Leave AI_API_KEY empty in versioned files. Provide via local env or secrets.
      - AI_API_KEY=
    healthcheck:
      test:
        [
          "CMD",
          "node",
          "-e",
          "const http=require('http');http.get('http://localhost:5000/',r=>process.exit(r.statusCode===200?0:1)).on('error',()=>process.exit(1))",
        ]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 20s
    extra_hosts:
      - "host.docker.internal:host-gateway"
